# cargo-rail configuration
# Documentation: https://github.com/loadingalias/cargo-rail

# Targets for multi-platform validation (runs `cargo metadata --filter-platform <target>` per target)
targets = [
  "aarch64-apple-darwin",
  "aarch64-pc-windows-msvc",
  "aarch64-unknown-linux-gnu",
  "aarch64-unknown-linux-musl",
  "wasm32-unknown-unknown",
  "x86_64-apple-darwin",
  "x86_64-pc-windows-msvc",
  "x86_64-unknown-linux-gnu",
  "x86_64-unknown-linux-musl",
]

[unify]
include_paths = true
include_renamed = false

pin_transitives = false  # enable for hakari/workspace-hack users
transitive_host = "root" # only used if pin_transitives = true

strict_version_compat = true
exact_pin_handling = "warn"
major_version_conflict = "warn" # warn = skip, bump = force highest

msrv = true
msrv_source = "workspace" # deps | workspace | max

detect_unused = true
remove_unused = true # requires detect_unused = true

prune_dead_features = true
# glob patterns to keep from pruning
preserve_features = []
detect_undeclared_features = true
# requires detect_undeclared_features = true
fix_undeclared_features = true
skip_undeclared_patterns = ["default", "std", "alloc", "*_backend", "*_impl"]

exclude = []
include = []
max_backups = 3
sort_dependencies = true # false to preserve existing order

[release]
tag_prefix = "v"
tag_format = "{crate}@{version}"  # e.g. my-crate-v1.0.0 (with tag_prefix = "v")
require_clean = false
publish_delay = 5                 # seconds between publishes
create_github_release = false
sign_tags = false
changelog_path = "CHANGELOG.md"
changelog_relative_to = "crate"   # crate = per-crate, workspace = single file
skip_changelog_for = []
require_changelog_entries = false

[change-detection]
# Paths that trigger full workspace rebuild
infrastructure = [
  ".github/**",
  "scripts/**",
  "justfile",
  "Justfile",
  "Makefile",
  "makefile",
  "GNUmakefile",
  "*.sh",
  "Taskfile.yml",
  "Taskfile.yaml",
  ".pre-commit-config.yaml",
  "deny.toml",
  "cliff.toml",
  "release.toml",
  "release-plz.toml",
]

# Per-crate configuration: run 'cargo rail split init <crate>' to generate
# [crates.my-crate.split]
# remote = "git@github.com:org/my-crate.git"
# branch = "main"
# mode = "single"
# paths = [{ crate = "crates/my-crate" }]
